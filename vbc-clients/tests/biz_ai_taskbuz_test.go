package tests

import (
	"context"
	"encoding/json"
	"testing"
	"time"
	"vbc/internal/biz"
	"vbc/lib"
	. "vbc/lib/builder"
)

func Test_AiTaskbuzUsecase_HandleReturnTimezone(t *testing.T) {

	//clients, _ := UT.TUsecase.ListByCond(biz.Kind_clients, And(Eq{"biz_deleted_at": 0, "deleted_at": 0},
	//	Neq{"state": "", "city": ""}, In("id", []int32{98,
	//		5101,
	//		5160})))
	clients, _ := UT.TUsecase.ListByCond(biz.Kind_clients, And(Eq{"biz_deleted_at": 0, "deleted_at": 0},
		Neq{"state": "", "city": ""}))
	for k, _ := range clients {
		UT.AiTaskbuzUsecase.HandleReturnTimezone(clients[k])
		time.Sleep(time.Second * 5)
		//break
	}

	//
	//
	//tClient, _ := UT.TUsecase.DataByGid(biz.Kind_clients, "6159272000001008204")
	//err := UT.AiTaskbuzUsecase.HandleReturnTimezone(tClient)
	//lib.DPrintln(err)
}

func Test_AiTaskbuzUsecase_HandleReturnTimezoneJob(t *testing.T) {
	task, _ := UT.AiTaskUsecase.GetByCond(Eq{"id": 52})
	err := UT.AiTaskbuzUsecase.HandleReturnTimezoneJob(context.TODO(), task)
	lib.DPrintln(err)
}

func Test_AiTaskbuzUsecase_HandleCaseTimeZone(t *testing.T) {
	tClient, _ := UT.TUsecase.DataByGid(biz.Kind_clients, "6159272000001008204")
	err := UT.AiTaskbuzUsecase.HandleCaseTimeZone(tClient, 266)
	lib.DPrintln(err)
}

func Test_AiTaskbuzUsecase_HandleAutoAssociateJotform(t *testing.T) {
	task, _ := UT.AiTaskUsecase.GetByCond(Eq{"id": 115})
	tCase, _ := UT.TUsecase.DataById(biz.Kind_client_cases, task.CaseId)

	inputVo := lib.StringToTDef[*biz.AiTaskInputGenerateStatement](task.Input, nil)
	if inputVo == nil {
		panic("inputVo is nil")
	}

	StatementCondition, err := UT.StatementConditionUsecase.GetByCond(Eq{"id": inputVo.StatementConditionId})
	if err != nil {
		panic(err)
	}

	submissions, err := UT.AiTaskbuzUsecase.HandleAutoAssociateJotform(*tCase, StatementCondition.ToStatementCondition())
	lib.DPrintln(err)
	for _, v := range submissions {
		aa, _ := v.JotformNewFileNameForAI()
		lib.DPrintln(aa)
	}
}

func Test_AiTaskbuzUsecase_DoAutoAssociateJotform(t *testing.T) {
	task, _ := UT.AiTaskUsecase.GetByCond(Eq{"id": 115})
	tCase, _ := UT.TUsecase.DataById(biz.Kind_client_cases, task.CaseId)

	inputVo := lib.StringToTDef[*biz.AiTaskInputGenerateStatement](task.Input, nil)
	if inputVo == nil {
		panic("inputVo is nil")
	}
	StatementCondition, err := UT.StatementConditionUsecase.GetByCond(Eq{"id": inputVo.StatementConditionId})
	if err != nil {
		panic(err)
	}

	err = UT.AiTaskbuzUsecase.DoAutoAssociateJotform(*tCase, StatementCondition.ToStatementCondition())
	lib.DPrintln(err)
}

func Test_AiTaskbuzUsecase_HandleAssociateJotform(t *testing.T) {
	//tClient, _ := UT.TUsecase.DataByGid(biz.Kind_clients, "6159272000001008204")
	//err := UT.AiTaskbuzUsecase.HandleAssociateJotform(tClient, 266)
	//lib.DPrintln(err)
}

func Test_AiTaskbuzUsecase_GenUpdatePS(t *testing.T) {
	tCase, _ := UT.TUsecase.DataById(biz.Kind_client_cases, 5373)
	_, b, c, err := UT.AiTaskbuzUsecase.GenUpdatePS(context.TODO(), *tCase, "")
	lib.DPrintln(err)
	lib.DPrintln(b)
	lib.DPrintln(c)
}

func Test_AiTaskbuzUsecase_HandleUpdateStatement(t *testing.T) {
	task, _ := UT.AiTaskUsecase.GetByCond(Eq{"id": 729})
	err := UT.AiTaskbuzUsecase.HandleUpdateStatement(context.TODO(), task)
	lib.DPrintln(err)
}
func Test_AiTaskbuzUsecase_HandleUpdateStatementDoc(t *testing.T) {
	//task, _ := UT.AiTaskUsecase.GetByCond(Eq{"id": 729})
	//UT.AiTaskbuzUsecase.HandleUpdateStatementDoc(task.GetAiTaskInputUpdateStatementTask().PersonalStatementsVo, 753)
}

func Test_AiTaskbuzUsecase_CreateUpdateStatementDoc(t *testing.T) {

	//task, _ := UT.AiTaskUsecase.GetByCond(Eq{"id": 729})
	//tCase, _ := UT.TUsecase.DataById(biz.Kind_client_cases, task.CaseId)
	//tClient, _, _ := UT.DataComboUsecase.Client(tCase.CustomFields.TextValueByNameBasic(biz.FieldName_client_gid))
	//list, _ := UT.AiTaskbuzUsecase.HandleUpdateStatementDoc(task.GetAiTaskInputUpdateStatementTask().PersonalStatementsVo, 753)
	//err := UT.AiTaskbuzUsecase.CreateUpdateStatementDoc(*tClient, *tCase, task.GetAiTaskInputUpdateStatementTask().PersonalStatementsVo, list)
	//lib.DPrintln(err)
}

func Test_AiTaskbuzUsecase_Replay_ai_request(t *testing.T) {

	var claude3Request biz.Claude3Request

	ai_request := `{"anthropic_version":"bedrock-2023-05-31","max_tokens":4048,"messages":[{"role":"user","content":[{"type":"text","text":"[{\"name\":\"heading\",\"order\":\"1\",\"text\":\"Initial Intake Questionnaire\",\"type\":\"control_head\"},{\"answer\":{\"first\":\"Evan\",\"last\":\"Wagner\"},\"name\":\"fullName\",\"order\":\"2\",\"prettyFormat\":\"Evan Wagner\",\"sublabels\":\"{\\\"prefix\\\":\\\"Prefix\\\",\\\"first\\\":\\\"First Name\\\",\\\"middle\\\":\\\"Middle Name\\\",\\\"last\\\":\\\"Last Name\\\",\\\"suffix\\\":\\\"Suffix\\\"}\",\"text\":\"Full Name\",\"type\":\"control_fullname\"},{\"answer\":\"5547\",\"name\":\"uniqueId\",\"order\":\"3\",\"text\":\"Unique ID\",\"type\":\"control_textbox\"},{\"answer\":[\"Air Force\"],\"name\":\"branchOf\",\"order\":\"4\",\"prettyFormat\":\"Air Force\",\"text\":\"Branch of Service:\",\"type\":\"control_checkbox\"},{\"answer\":\"2011-2017\",\"name\":\"whatYears210\",\"order\":\"5\",\"text\":\"What years did you serve? \",\"type\":\"control_textarea\"},{\"answer\":\"No\",\"name\":\"didYou\",\"order\":\"6\",\"text\":\"Did you retire from service?\",\"type\":\"control_radio\"},{\"answer\":\"Deployed to Afghanistan in 2015\",\"name\":\"didYou212\",\"order\":\"7\",\"text\":\"Did you deploy to any conflict areas on the presumptive lists? If yes, please list areas.\",\"type\":\"control_textarea\"},{\"answer\":\"Yes\",\"name\":\"areYou\",\"order\":\"8\",\"text\":\"Are you married?\",\"type\":\"control_radio\"},{\"answer\":\"No\",\"name\":\"haveYou\",\"order\":\"9\",\"text\":\"Have you ever been divorced?\",\"type\":\"control_radio\"},{\"answer\":\"Married 2014 - Present\",\"name\":\"ifYes215\",\"order\":\"10\",\"text\":\"If yes, please include marriage and divorce year. Ex) 1990-1995\",\"type\":\"control_textarea\"},{\"answer\":\"Yes\",\"name\":\"doYou\",\"order\":\"11\",\"text\":\"Do you have any children?\",\"type\":\"control_radio\"},{\"answer\":\"2 young children\",\"name\":\"ifYes219\",\"order\":\"12\",\"text\":\"If yes, please include number of children and grandchildren, if applicable.\",\"type\":\"control_textarea\"},{\"answer\":\"3PO51/Security Forces\",\"name\":\"whatWas\",\"order\":\"13\",\"text\":\"What was your occupation in service?\",\"type\":\"control_textarea\"},{\"answer\":\"Life as a Security Forces Member (3P051) in the US Air Force, 2011-2017\\nI enlisted in 2011, heading straight to Basic Military Training at Lackland AFB. After graduating in October, I stayed at Lackland for the Security Forces Apprentice Course, which I completed in January 2012. Those first months were intense - learning law enforcement procedures, weapons handling, combat tactics, and the mental discipline required for the job.\\nAs a 3P051 Security Forces member, I was the Air Force's first line of defense. My job was to maintain the rule of law on all Air Force bases and installations, handling all police activities associated with an Air Force base. This meant I was essentially military police with additional combat and security responsibilities.\\nDaily Routine and Physical Demands\\nThe physical demands started with the schedule itself. We typically worked one of three shift patterns: either 8-hour shifts that often stretched to 10 hours with arming up and de-arming before and after shift, 12-hour shifts that could extend to 14 hours, or a rotating schedule of \\\"two day shifts, two swing shifts, two mid shifts, and four days off.\\\" These irregular hours meant my body never fully adjusted to any sleep pattern.\\nDuring duty, I encountered \\\"significant physical stressors, including protracted duty days, shift-work schedules, prolonged standing, environmental exposures, and heavy loads from gear and weapons.\\\" On a typical day, I'd stand post for hours wearing 30+ pounds of gear including body armor, weapon, ammunition, and other equipment regardless of weather conditions. The physical toll was constant - back pain became my companion from working those long shifts in full gear.\\nWhen patrolling the base perimeter, I'd walk miles daily while remaining hypervigilant. Entry control point duty meant standing for extended periods, checking IDs and inspecting vehicles. During exercises and real-world responses, I'd run with all my gear to reach incident locations quickly. The constant physical readiness requirements meant regular physical training was mandatory to maintain the strength and endurance needed for the job.\\nMental Demands and Stressors\\nThe mental aspects were equally challenging. The job came with \\\"a lot of pressure\\\" and could cause \\\"mental and physical stress.\\\" As Security Forces, I was responsible for protecting assets, defending air bases, and potentially using deadly force. This enormous responsibility weighed on me every day.\\nThe constant vigilance required was mentally exhausting. I was tasked with \\\"keeping the people, planes, base, weapons, and the surrounding area safe from any threat.\\\" Every shift, I had to remain alert for hours, watching for anything suspicious while dealing with routine tasks. This hypervigilance, necessary for the job, created a persistent state of stress.\\nThe long shifts contributed to \\\"mental fatigue\\\" and sometimes created \\\"strains on marriage or personal life.\\\" After completing ALS (Airman Leadership School) in 2016, I gained additional supervisory responsibilities that added another layer of mental pressure, as I was now responsible for the performance and well-being of junior Airmen.\\nDeployment Experience in Afghanistan\\nMy deployment to Afghanistan was the most intense period of my service. Having completed Evasion Conduct After Capture training in 2015 prepared me mentally, but nothing fully prepares you for the reality of a combat zone.\\nWar exposure significantly increased \\\"risk of exposure to trauma, which in turn, predicted elevated PTS symptoms and resource loss.\\\"  The threat of attack was constant. I experienced the stress of convoy operations, checking for IEDs, manning entry control points, and responding to security threats - all while knowing that any routine duty could turn deadly in seconds.\\nMy combat deployment earned me the Afghanistan Campaign Medal with 1 Service Star, but it came with a cost. The constant threat awareness created a hypervigilance that followed me home. Studies found that about 13.5% of military personnel deployed to Afghanistan developed deployment-related mental disorders, with PTSD being the most common diagnosis. \\nAnxiety-Inducing Aspects\\nSeveral aspects of the job specifically triggered anxiety:\\nLife-or-death decisions: Being authorized to use deadly force meant potentially having to make split-second decisions that could end a life or save many. This responsibility was always in the back of my mind.\\nUnpredictable incidents: Never knowing when an alarm would sound or an incident would occur kept me in a state of readiness that was difficult to turn off.\\nShift work disruption: The 24-hour career nature meant \\\"shift work consisting of Days, Afternoons, and Midnights\\\" which disrupted sleep patterns and created chronic fatigue. This impacted my ability to manage stress effectively.\\nLeadership dynamics: Dealing with \\\"constant policy changes\\\" and shifts that sometimes had \\\"no clear direction\\\" added organizational stress to an already demanding job. \\nDeployment uncertainty: Never knowing when I'd be deployed again or what conditions I'd face created background anxiety that affected long-term planning.\\n\\nAfter completing Airman Leadership School in 2016, I took on trainer responsibilities using my Air Force Trainer Course certification from 2014. This added the stress of being responsible for others' performance and readiness, knowing their lives might depend on how well I trained them.\\nDespite the challenges, earning the AF Outstanding Unit Award, AF Organizational Excellence Award, AF Good Conduct Medal, National Defense Service Medal, Afghanistan Campaign Medal with 1 Service Star, Global War on Terrorism Service Medal, and Air Force Expeditionary Service Ribbon with Gold Border reflected my dedication to the mission and ability to perform under these demanding conditions.\\nThe experience shaped me into someone who can handle extreme pressure, remain vigilant in chaotic situations, and lead others through challenging circumstances - but it came with physical and mental costs that I still manage today.\",\"name\":\"whatWere\",\"order\":\"14\",\"text\":\"What were some challenges you had to overcome during your time in service?\",\"type\":\"control_textarea\"},{\"name\":\"additionalComments\",\"order\":\"15\",\"text\":\"Additional comments:\",\"type\":\"control_textarea\"},{\"name\":\"submit2\",\"order\":\"16\",\"text\":\"Submit\",\"type\":\"control_button\"}]"}]},{"role":"assistant","content":[{"type":"text","text":"# VETERAN SUMMARY\n\n• Full Name: Evan Wagner\n• Unique ID: 5547\n• Branch of Service: Air Force\n• Years of Service: 2011-2017\n• Retirement status: Did not retire from service\n• Deployments: Afghanistan in 2015\n• Marital Status: Married since 2014\n• Children: 2 young children\n• Occupation in service: 3PO51/Security Forces\n\nTo proceed with creating VA disability personal statements, I'll need specific information about which medical conditions you're seeking VA benefits for. Once you provide details about specific conditions, I can create comprehensive personal statements that connect your conditions to your military service."}]},{"role":"user","content":[{"type":"text","text":"Reference materials:\n[{\"name\":\"heading\",\"order\":\"1\",\"text\":\"Post-Traumatic Stress Disorder (PTSD) Questionnaire\",\"type\":\"control_head\"},{\"answer\":{\"first\":\"Evan\",\"last\":\"Wagner\"},\"name\":\"fullName\",\"order\":\"2\",\"prettyFormat\":\"Evan Wagner\",\"sublabels\":\"{\\\"prefix\\\":\\\"Prefix\\\",\\\"first\\\":\\\"First Name\\\",\\\"middle\\\":\\\"Middle Name\\\",\\\"last\\\":\\\"Last Name\\\",\\\"suffix\\\":\\\"Suffix\\\"}\",\"text\":\"Full Name\",\"type\":\"control_fullname\"},{\"answer\":\"5547\",\"name\":\"uniqueId\",\"order\":\"3\",\"text\":\"Unique ID\",\"type\":\"control_textbox\"},{\"answer\":\"Yes\",\"name\":\"didThe\",\"order\":\"4\",\"text\":\"Did the condition begin during active duty service?\",\"type\":\"control_radio\"},{\"answer\":\"New\",\"name\":\"isThis\",\"order\":\"5\",\"text\":\"Is this for a new condition or increase?\",\"type\":\"control_radio\"},{\"answer\":[\"Combat Traumatic Event(s)\"],\"name\":\"selectThe\",\"order\":\"6\",\"prettyFormat\":\"Combat Traumatic Event(s)\",\"text\":\"Select the type of in-service traumatic event(s) you experience: (check all that apply)\",\"type\":\"control_checkbox\"},{\"name\":\"pageBreak159\",\"order\":\"7\",\"text\":\"Page Break\",\"type\":\"control_pagebreak\"},{\"name\":\"stressfulIncident\",\"order\":\"8\",\"text\":\"Stressful Incident 1\",\"type\":\"control_head\"},{\"answer\":\"Oct 02, 2015\",\"name\":\"dateFirst\",\"order\":\"9\",\"text\":\"Date first incident occurred?\",\"type\":\"control_textbox\"},{\"answer\":\"April 2015 - October 2015\",\"name\":\"datesOf\",\"order\":\"10\",\"text\":\"Dates of unit assignment?\",\"type\":\"control_textbox\"},{\"answer\":\"455th Security Forces Expeditionary\",\"name\":\"unitAssignment\",\"order\":\"11\",\"text\":\"Unit assignment during incident?\",\"type\":\"control_textbox\"},{\"answer\":\"I was deployed to Bagram AB in Afghanistan and assigned to the 455th Security Forces Expeditionary.  While there and near the end of our deployment, two of my fellow Airmen were on a C-130, call sign TORGE 62, returning to Bagram AB from Jalalabad Airfield, providing security when the plane went down.\\n\\nI was sleeping in my bunk when leadership came to our barracks and woke us up.  We form up around the table in the main area of the barracks with the other members of our unit.  We had about 100 Airmen in our unit so we all knew each other.  Once we were all assembled, leadership briefed us on the details of the plane crash and loss of everyone on board including our fellow Security Forces members.  The C-130 crashed 28 seconds after take off killing all 11 members on board, and 3 on the ground. \\n\\nThe mood was very somber, everyone was in disbelief, and I had a sense of guilt.  I felt it guilt that it could have or should have been me.  \\n\\nAirman 1st Class Kcey Ruiz was one of the Airman on the C-130 and killed in the crash.  She and I had worked closely together at Hanscom Air Force Base, MA. for at least a year before the deployment.  We stood Gate Entry duty, patrol, she would hang out with me when I was working dispatch.  We got to know each other well and became friends. \\n\\nSenior Airman Nathan Sartain was another one of the Airman on the C-130 that was killed in the crash.  He and I knew each other from SEER and other Security training before deployment. He was from Florida like me, and I remember he was a funny guy.  I would see and talk to him in passing when we were deployed.\\n\\nHearing of their death in this way and so close to returning home was very difficult to deal with.  On our return from the deployment we stopped in Germany for Deployment Assistance Transition before returning home to Hanscom AB.\\n\\nWhen I retuned to Hanscom AB and worked the same Gate and duty I shared with Kcey Ruiz it was upsetting.  Nathan Sartain usually worked opposite shifts and would come relieve Ruiz and I.  It was odd and surreal that neither of them were with me anymore.\",\"name\":\"descriptionOf\",\"order\":\"12\",\"text\":\"Description of Incident: Ex) We were deployed to Afghanistan and a mortar hit our base.\",\"type\":\"control_textarea\"},{\"name\":\"medalsAnd\",\"order\":\"13\",\"text\":\"Medals and citations earned due to event:\",\"type\":\"control_textarea\"},{\"answer\":\"Capt. Jordan Pierson\\nCapt. Jonathan Golden\\nStaff Sgt. Ryan Hammond\\nSenior Airman Quinn Johnson-Harris\\nSenior Airman Nathan Sartain\\nAirman 1st Class Kcey Ruiz.\",\"name\":\"nameOf\",\"order\":\"14\",\"text\":\"Name of person, rank, date of injury/death:\",\"type\":\"control_textarea\"},{\"answer\":\"Killed (Non-battle)\",\"name\":\"pleaseCheck158\",\"order\":\"15\",\"text\":\"Please check one (Incident 1):\",\"type\":\"control_radio\"},{\"name\":\"pageBreak162\",\"order\":\"16\",\"text\":\"Page Break\",\"type\":\"control_pagebreak\"},{\"name\":\"stressfulIncident163\",\"order\":\"17\",\"text\":\"Stressful Incident 2\",\"type\":\"control_head\"},{\"name\":\"dateSecond\",\"order\":\"18\",\"text\":\"Date second incident occurred?\",\"type\":\"control_textbox\"},{\"name\":\"datesOf165\",\"order\":\"19\",\"text\":\"Dates of unit assignment?\",\"type\":\"control_textbox\"},{\"name\":\"unitAssignment166\",\"order\":\"20\",\"text\":\"Unit assignment during incident?\",\"type\":\"control_textbox\"},{\"name\":\"descriptionOf167\",\"order\":\"21\",\"text\":\"Description of Incident: \",\"type\":\"control_textarea\"},{\"name\":\"medalsAnd168\",\"order\":\"22\",\"text\":\"Medals and citations earned due to event:\",\"type\":\"control_textarea\"},{\"name\":\"nameOf169\",\"order\":\"23\",\"text\":\"Name of person, rank, date of injury/death:\",\"type\":\"control_textarea\"},{\"name\":\"pleaseCheck170\",\"order\":\"24\",\"text\":\"Please check one (Incident 2):\",\"type\":\"control_radio\"},{\"name\":\"pageBreak171\",\"order\":\"25\",\"text\":\"Page Break\",\"type\":\"control_pagebreak\"},{\"answer\":\"Yes\",\"name\":\"didYou24\",\"order\":\"26\",\"text\":\"Did you go to the doctor?\",\"type\":\"control_radio\"},{\"answer\":\"March 11th and 14th, 2016 during a Post Deployment Health Assessment, I reported chronic dreams/bad thoughts about Airmen we lost on deployment.  \\n\\nThe impact of my experiences during deployment hadn't fully impacted me at first, when I was evaluated.  It was only later when I was left to deal with them alone that it really started hitting me hard.\",\"name\":\"ifYes\",\"order\":\"27\",\"text\":\"If yes, what did they do for you? \",\"type\":\"control_textarea\"},{\"name\":\"pleaseCheck185\",\"order\":\"28\",\"text\":\"Please check all that apply:\",\"type\":\"control_checkbox\"},{\"name\":\"pageBreak\",\"order\":\"29\",\"text\":\"Page Break\",\"type\":\"control_pagebreak\"},{\"name\":\"currentSituation\",\"order\":\"30\",\"text\":\"Current Situation\",\"type\":\"control_head\"},{\"cfname\":\"Date Picker\",\"name\":\"typeA\",\"order\":\"31\",\"selectedField\":\"52934dbf3be147110a000030\",\"static\":\"No\",\"text\":\"When did you most recently see a doctor regarding this medical issue?\",\"type\":\"control_widget\"},{\"answer\":\"Current Situation\",\"name\":\"inputFor\",\"order\":\"32\",\"text\":\"Input for prompt\",\"type\":\"control_textbox\"},{\"answer\":[\"Worse in frequency\",\"Worse in severity\"],\"name\":\"howWould\",\"order\":\"33\",\"prettyFormat\":\"Worse in frequency; Worse in severity\",\"text\":\"How would you characterize your condition since your first encounter (check all that apply)?\",\"type\":\"control_checkbox\"},{\"answer\":\"No\",\"name\":\"areYou\",\"order\":\"34\",\"text\":\"Are you currently undergoing counseling? If yes, indicate frequency.\",\"type\":\"control_radio\"},{\"answer\":\"No\",\"name\":\"doYou98\",\"order\":\"35\",\"text\":\"Do you take medication for your condition?\",\"type\":\"control_radio\"},{\"name\":\"ifYes26\",\"order\":\"36\",\"text\":\"If yes, please list all medications.\",\"type\":\"control_textarea\"},{\"name\":\"doYou34\",\"order\":\"37\",\"text\":\"Do you think your counseling/medications are improving your condition?\",\"type\":\"control_radio\"},{\"name\":\"haveYou\",\"order\":\"38\",\"text\":\"Have you had any legal troubles in the past 10 years? If yes, explain. \",\"type\":\"control_textarea\"},{\"name\":\"doYou\",\"order\":\"39\",\"text\":\"Do you drink, smoke, or use drugs to cope with your mental health challenges? \",\"type\":\"control_textarea\"},{\"answer\":\"Yes\",\"name\":\"doYou109\",\"order\":\"40\",\"text\":\"Do you feel competent to manage your financial affairs?\",\"type\":\"control_radio\"},{\"answer\":[\"Deficiencies in most areas such as work, school, family relations, etc.\"],\"name\":\"whichOf\",\"order\":\"41\",\"prettyFormat\":\"Deficiencies in most areas such as work, school, family relations, etc.\",\"text\":\"Which of the following BEST describes your level of occupational and social impairment with regards to your mental disability?\",\"type\":\"control_checkbox\"},{\"name\":\"pageBreak117\",\"order\":\"42\",\"text\":\"Page Break\",\"type\":\"control_pagebreak\"},{\"name\":\"ptsdHistory\",\"order\":\"43\",\"text\":\"PTSD History\",\"type\":\"control_head\"},{\"answer\":\"PTSD History\",\"name\":\"inputFor175\",\"order\":\"44\",\"text\":\"Input for prompt\",\"type\":\"control_textbox\"},{\"answer\":[\"I learned that the traumatic event occurred to a close family member or close friend, that involved actual or threatened death or serious injury, or a threat to the physical integrity of self or others\"],\"name\":\"pleaseCheck\",\"order\":\"45\",\"prettyFormat\":\"I learned that the traumatic event occurred to a close family member or close friend, that involved actual or threatened death or serious injury, or a threat to the physical integrity of self or others\",\"text\":\"Please check all that apply regarding the history of your condition:\",\"type\":\"control_checkbox\"},{\"answer\":[\"I experience recurrent distressing dreams of the event\",\"Intense psychological distress at exposure to internal or external cues that symbolize or resemble and aspect of the traumatic event\"],\"name\":\"pleaseCheck148\",\"order\":\"46\",\"prettyFormat\":\"I experience recurrent distressing dreams of the event; Intense psychological distress at exposure to internal or external cues that symbolize or resemble and aspect of the traumatic event\",\"text\":\"Please check all that apply regarding the traumatic event:\",\"type\":\"control_checkbox\"},{\"answer\":[\"Avoidance and efforts to avoid distressing memories, thoughts or feelings about the traumatic event\",\"Avoidance and efforts to avoid reminders like people, places, conversation, etc. that arouse distressing memories thoughts or feelings about the traumatic event\"],\"name\":\"doYou149\",\"order\":\"47\",\"prettyFormat\":\"Avoidance and efforts to avoid distressing memories, thoughts or feelings about the traumatic event; Avoidance and efforts to avoid reminders like people, places, conversation, etc. that arouse distressing memories thoughts or feelings about the traumatic event\",\"text\":\"Do you have any of the following symptoms now?\",\"type\":\"control_checkbox\"},{\"answer\":[\"Persistent and exaggerated negative beliefs or expectations about oneself, others, or the world\"],\"name\":\"doYou150\",\"order\":\"48\",\"prettyFormat\":\"Persistent and exaggerated negative beliefs or expectations about oneself, others, or the world\",\"text\":\"Do you have any of the following symptoms after the trauma?\",\"type\":\"control_checkbox\"},{\"answer\":[\"Difficulty falling or staying asleep\",\"Hypervigilance\",\"Exaggerated startle response\"],\"name\":\"doYou151\",\"order\":\"49\",\"prettyFormat\":\"Difficulty falling or staying asleep; Hypervigilance; Exaggerated startle response\",\"text\":\"Do you have any of the following symptoms now, which were not present before the trauma?\",\"type\":\"control_checkbox\"},{\"name\":\"pageBreak145\",\"order\":\"50\",\"text\":\"Page Break\",\"type\":\"control_pagebreak\"},{\"name\":\"impactOn\",\"order\":\"51\",\"text\":\"Impact on Daily, Work, and Social Life\",\"type\":\"control_head\"},{\"answer\":\"Impact on Daily, Work, and Social Life\",\"name\":\"inputFor177\",\"order\":\"52\",\"text\":\"Input for prompt\",\"type\":\"control_textbox\"},{\"answer\":[\"I occasionally sit in my car before entering work, struggling to go inside\"],\"name\":\"grossImpairment147\",\"order\":\"53\",\"prettyFormat\":\"I occasionally sit in my car before entering work, struggling to go inside\",\"text\":\"Depressed Mood:\",\"type\":\"control_checkbox\"},{\"answer\":[\"Sudden loud noises startle me more than they used to\"],\"name\":\"anxiety\",\"order\":\"54\",\"prettyFormat\":\"Sudden loud noises startle me more than they used to\",\"text\":\"Anxiety:\",\"type\":\"control_checkbox\"},{\"answer\":[\"I check my locks multiple times before bed\"],\"name\":\"suspiciousness\",\"order\":\"55\",\"prettyFormat\":\"I check my locks multiple times before bed\",\"text\":\"Suspiciousness:\",\"type\":\"control_checkbox\"},{\"name\":\"panicAttacks\",\"order\":\"56\",\"text\":\"Panic Attacks:\",\"type\":\"control_checkbox\"},{\"answer\":[\"My eating patterns have become irregular or problematic\"],\"name\":\"nearcontinuousPanicdepression\",\"order\":\"57\",\"prettyFormat\":\"My eating patterns have become irregular or problematic\",\"text\":\"Near-continuous Panic/Depression Affecting Function:\",\"type\":\"control_checkbox\"},{\"answer\":[\"I need background noise, like the TV, to fall asleep\"],\"name\":\"chronicSleep\",\"order\":\"58\",\"prettyFormat\":\"I need background noise, like the TV, to fall asleep\",\"text\":\"Chronic Sleep Impairment:\",\"type\":\"control_checkbox\"},{\"answer\":[\"I forget why I walked into a room\"],\"name\":\"mildMemory\",\"order\":\"59\",\"prettyFormat\":\"I forget why I walked into a room\",\"text\":\"Mild Memory Loss:\",\"type\":\"control_checkbox\"},{\"answer\":[\"I struggle to retain new information at work\"],\"name\":\"shortAnd\",\"order\":\"60\",\"prettyFormat\":\"I struggle to retain new information at work\",\"text\":\"Short and Long-term Memory Impairment:\",\"type\":\"control_checkbox\"},{\"name\":\"memoryLoss\",\"order\":\"61\",\"text\":\"Memory Loss of Names/Occupation:\",\"type\":\"control_checkbox\"},{\"answer\":[\"People sometimes think I’m angry when I’m not\"],\"name\":\"flattenedAffect\",\"order\":\"62\",\"prettyFormat\":\"People sometimes think I’m angry when I’m not\",\"text\":\"Flattened Affect:\",\"type\":\"control_checkbox\"},{\"answer\":[\"I slur my words when I’m tired\"],\"name\":\"speechDisorder\",\"order\":\"63\",\"prettyFormat\":\"I slur my words when I’m tired\",\"text\":\"Speech Disorder:\",\"type\":\"control_checkbox\"},{\"answer\":[\"I have trouble keeping track of multiple tasks\"],\"name\":\"difficultyUnderstanding\",\"order\":\"64\",\"prettyFormat\":\"I have trouble keeping track of multiple tasks\",\"text\":\"Difficulty Understanding Complex Commands:\",\"type\":\"control_checkbox\"},{\"answer\":[\"I often agree to things without thinking them through\"],\"name\":\"impairedJudgment\",\"order\":\"65\",\"prettyFormat\":\"I often agree to things without thinking them through\",\"text\":\"Impaired Judgment:\",\"type\":\"control_checkbox\"},{\"name\":\"impairedAbstract\",\"order\":\"66\",\"text\":\"Impaired Abstract Thinking:\",\"type\":\"control_checkbox\"},{\"answer\":[\"My mind often feels clouded\"],\"name\":\"impairmentIn\",\"order\":\"67\",\"prettyFormat\":\"My mind often feels clouded\",\"text\":\"Impairment in Thought Process:\",\"type\":\"control_checkbox\"},{\"answer\":[\"Getting out of bed feels impossible\"],\"name\":\"disturbancesOf\",\"order\":\"68\",\"prettyFormat\":\"Getting out of bed feels impossible\",\"text\":\"Disturbances of Mood and Motivation\",\"type\":\"control_checkbox\"},{\"name\":\"difficultyIn\",\"order\":\"69\",\"text\":\"Difficulty in Work/Social Relationships:\",\"type\":\"control_checkbox\"},{\"answer\":[\"I have difficulty adapting to workplace changes\"],\"name\":\"difficultyAdapting\",\"order\":\"70\",\"prettyFormat\":\"I have difficulty adapting to workplace changes\",\"text\":\"Difficulty Adapting to Stress:\",\"type\":\"control_checkbox\"},{\"answer\":[\"I think about not being here sometimes\"],\"name\":\"suicidalThoughts\",\"order\":\"71\",\"prettyFormat\":\"I think about not being here sometimes\",\"text\":\"Suicidal Thoughts:\",\"type\":\"control_checkbox\"},{\"answer\":[\"I mentally repeat words or phrases\"],\"name\":\"obsessionalRituals\",\"order\":\"72\",\"prettyFormat\":\"I mentally repeat words or phrases\",\"text\":\"Obsessional Rituals Interfering with Routine Activities:\",\"type\":\"control_checkbox\"},{\"answer\":{\"other\":\"I buy things impulsively\"},\"name\":\"impairedImpulse\",\"order\":\"73\",\"prettyFormat\":\"I buy things impulsively\",\"text\":\"Impaired Impulse Control:\",\"type\":\"control_checkbox\"},{\"answer\":[\"I bump into furniture more often now\"],\"name\":\"spatialDisorientation\",\"order\":\"74\",\"prettyFormat\":\"I bump into furniture more often now\",\"text\":\"Spatial Disorientation:\",\"type\":\"control_checkbox\"},{\"answer\":[\"I see shadows moving out of the corner of my eye\"],\"name\":\"persistentDelusionshallucinations\",\"order\":\"75\",\"prettyFormat\":\"I see shadows moving out of the corner of my eye\",\"text\":\"Persistent Delusions/Hallucinations:\",\"type\":\"control_checkbox\"},{\"answer\":[\"I practice drill movements at work\"],\"name\":\"grosslyInappropriate\",\"order\":\"76\",\"prettyFormat\":\"I practice drill movements at work\",\"text\":\"Grossly Inappropriate Behavior:\",\"type\":\"control_checkbox\"},{\"answer\":[\"I find myself planning defensive tactics frequently\"],\"name\":\"persistentDanger\",\"order\":\"77\",\"prettyFormat\":\"I find myself planning defensive tactics frequently\",\"text\":\"Persistent Danger:\",\"type\":\"control_checkbox\"},{\"answer\":[\"I forget to brush my teeth regularly\"],\"name\":\"neglectOf\",\"order\":\"78\",\"prettyFormat\":\"I forget to brush my teeth regularly\",\"text\":\"Neglect of Personal Appearance:\",\"type\":\"control_checkbox\"},{\"answer\":[\"Simple chores occasionally become impossible\"],\"name\":\"intermittentInability\",\"order\":\"79\",\"prettyFormat\":\"Simple chores occasionally become impossible\",\"text\":\"Intermittent Inability for Daily Activities:\",\"type\":\"control_checkbox\"},{\"answer\":[\"I find it hard to remember when events happened\"],\"name\":\"disorientationTo\",\"order\":\"80\",\"prettyFormat\":\"I find it hard to remember when events happened\",\"text\":\"Disorientation to Time/Place:\",\"type\":\"control_checkbox\"},{\"answer\":\"When I hear loud sounds like a pop or crack that is unexpected I jump and will get goose bumps, and have to turn to see the source of the sound, not just go with what I know the sound to be.\",\"name\":\"doesAnything\",\"order\":\"81\",\"text\":\"Does anything in your daily life cause flashbacks? If yes, please explain.\",\"type\":\"control_textarea\"},{\"answer\":[\"Flashbacks or intrusive thoughts disrupting daily activities\",\"Heightened startle response affecting overall comfort\"],\"name\":\"howDoes\",\"order\":\"82\",\"prettyFormat\":\"Flashbacks or intrusive thoughts disrupting daily activities; Heightened startle response affecting overall comfort\",\"text\":\"How does this condition affect your daily life?\",\"type\":\"control_checkbox\"},{\"answer\":[\"Nightmares or night terrors causing frequent awakenings\"],\"name\":\"howDoes183\",\"order\":\"83\",\"prettyFormat\":\"Nightmares or night terrors causing frequent awakenings\",\"text\":\"How does this condition affect your sleep?\",\"type\":\"control_checkbox\"},{\"answer\":{\"0\":\"Reduced productivity due to concentration issues\",\"other\":\"Prefer to work from home as I don't like working in an office and getting to know my coworkers as I might lose them.\"},\"name\":\"howDoes184\",\"order\":\"84\",\"prettyFormat\":\"Reduced productivity due to concentration issues; Prefer to work from home as I don't like working in an office and getting to know my coworkers as I might lose them.\",\"text\":\"How does this condition affect your ability to work?\",\"type\":\"control_checkbox\"},{\"name\":\"additionalComments\",\"order\":\"85\",\"text\":\"Additional comments:\",\"type\":\"control_textarea\"},{\"name\":\"submit2\",\"order\":\"86\",\"text\":\"Submit\",\"type\":\"control_button\"}]\n[{\"name\":\"heading\",\"order\":\"1\",\"text\":\"Male Reproductive Organ Conditions  Questionnaire\",\"type\":\"control_head\"},{\"answer\":{\"first\":\"Evan\",\"last\":\"Wagner\"},\"name\":\"fullName\",\"order\":\"2\",\"prettyFormat\":\"Evan Wagner\",\"sublabels\":\"{\\\"prefix\\\":\\\"Prefix\\\",\\\"first\\\":\\\"First Name\\\",\\\"middle\\\":\\\"Middle Name\\\",\\\"last\\\":\\\"Last Name\\\",\\\"suffix\\\":\\\"Suffix\\\"}\",\"text\":\"Full Name\",\"type\":\"control_fullname\"},{\"answer\":\"5547\",\"name\":\"uniqueId\",\"order\":\"3\",\"text\":\"Unique ID\",\"type\":\"control_textbox\"},{\"answer\":\"New\",\"name\":\"isThis\",\"order\":\"4\",\"text\":\"Is this for a new condition or increase?\",\"type\":\"control_radio\"},{\"name\":\"checkAll\",\"order\":\"5\",\"text\":\"Check all that apply:\",\"type\":\"control_checkbox\"},{\"name\":\"ifCondition\",\"order\":\"6\",\"text\":\"If condition found in STR, what is the name of the condition in STR?\",\"type\":\"control_textarea\"},{\"answer\":\"Erectile dysfunction secondary to PTSD\",\"name\":\"whatIs\",\"order\":\"7\",\"text\":\"What is the exact condition you are claiming? \",\"type\":\"control_textarea\"},{\"answer\":\"Yes\",\"name\":\"didThe135\",\"order\":\"8\",\"text\":\"Did the condition begin during active duty service?\",\"type\":\"control_radio\"},{\"answer\":\"2017\",\"name\":\"whatYear\",\"order\":\"9\",\"text\":\"What year did your condition begin?\",\"type\":\"control_textbox\"},{\"name\":\"whatUnit\",\"order\":\"10\",\"text\":\"What unit were you assigned to?\",\"type\":\"control_textbox\"},{\"name\":\"whereWere\",\"order\":\"11\",\"text\":\"Where were you located?\",\"type\":\"control_textbox\"},{\"answer\":\"While I was in the service I experience a traumatic event when two of my fellow airmen died in a plane crash.  This experience worsened with time and by the time I was out of the service I was having issues with erectile dysfunction.\",\"name\":\"brieflyDescribe\",\"order\":\"12\",\"text\":\"Briefly describe where and how you first encountered this condition: \",\"type\":\"control_textarea\"},{\"answer\":\"No\",\"name\":\"didYou24\",\"order\":\"13\",\"text\":\"Did you seek treatment when the condition began?\",\"type\":\"control_radio\"},{\"name\":\"ifYes145\",\"order\":\"14\",\"text\":\"If yes, what did they do for you?\",\"type\":\"control_checkbox\"},{\"name\":\"ifNo\",\"order\":\"15\",\"text\":\"If no, why didn't you seek treatment?\",\"type\":\"control_checkbox\"},{\"name\":\"ifYes\",\"order\":\"16\",\"text\":\"If yes, what did they do for you? \",\"type\":\"control_textarea\"},{\"name\":\"pageBreak\",\"order\":\"17\",\"text\":\"Page Break\",\"type\":\"control_pagebreak\"},{\"name\":\"currentSituation\",\"order\":\"18\",\"text\":\"Current Situation\",\"type\":\"control_head\"},{\"cfname\":\"Date Picker\",\"name\":\"typeA\",\"order\":\"19\",\"selectedField\":\"52934dbf3be147110a000030\",\"static\":\"No\",\"text\":\"When did you most recently see a doctor regarding this medical issue?\",\"type\":\"control_widget\"},{\"answer\":\"Yes\",\"name\":\"didYour\",\"order\":\"20\",\"text\":\"Did your symptoms get worse over time?\",\"type\":\"control_radio\"},{\"answer\":\"While trying to be intimate with my wife I will get distracted with the thoughts of the death of two of my friends and fellow airmen in Afghanistan.  This will cause me to lose my erection.\",\"name\":\"howDoes100\",\"order\":\"21\",\"text\":\"If yes, what makes your symptoms worse?\",\"type\":\"control_textarea\"},{\"name\":\"haveYou\",\"order\":\"22\",\"text\":\"Have you ever had an orchiectomy? If yes, indicate testicle removed.\",\"type\":\"control_radio\"},{\"name\":\"pleaseIndicate\",\"order\":\"23\",\"text\":\"Please indicate reason for removal.\",\"type\":\"control_textarea\"},{\"answer\":\"No\",\"name\":\"isThere\",\"order\":\"24\",\"text\":\"Is there any renal dysfunction due to condition?\",\"type\":\"control_radio\"},{\"name\":\"pageBreak107\",\"order\":\"25\",\"text\":\"Page Break\",\"type\":\"control_pagebreak\"},{\"name\":\"sectionI\",\"order\":\"26\",\"text\":\"Section I - Voiding Dysfunction\",\"type\":\"control_head\"},{\"answer\":\"No\",\"name\":\"areYou\",\"order\":\"27\",\"text\":\"Are you diagnosed with voiding dysfunction?\",\"type\":\"control_radio\"},{\"name\":\"whatDo\",\"order\":\"28\",\"text\":\"What do you think causes this voiding dysfunction (incomplete urination due to bladder problems etc.)?\",\"type\":\"control_textarea\"},{\"name\":\"doesVoiding\",\"order\":\"29\",\"text\":\"Does voiding dysfunction cause leakage of urine? If yes, indicate severity.\",\"type\":\"control_radio\"},{\"name\":\"doesThe\",\"order\":\"30\",\"text\":\"Does the voiding dysfunction require use of an appliance (catheter, etc.)? If yes, specify the appliance.\",\"type\":\"control_textarea\"},{\"name\":\"doesThe114\",\"order\":\"31\",\"text\":\"Does the voiding dysfunction cause any of these signs or symptoms of obstructed urination? (check all that apply):\",\"type\":\"control_checkbox\"},{\"name\":\"doesThe112\",\"order\":\"32\",\"text\":\"Does the voiding dysfunction cause increased frequency of urination (check all that apply):\",\"type\":\"control_checkbox\"},{\"name\":\"pageBreak116\",\"order\":\"33\",\"text\":\"Page Break\",\"type\":\"control_pagebreak\"},{\"name\":\"sectionIi\",\"order\":\"34\",\"text\":\"Section II - Erectile Dysfunction\",\"type\":\"control_head\"},{\"answer\":\"Yes\",\"name\":\"areYou118\",\"order\":\"35\",\"text\":\"Are you diagnosed with erectile dysfunction?\",\"type\":\"control_radio\"},{\"answer\":\"While trying to be intimate with my wife I will get distracted with the thoughts of the death of two of my friends and fellow airmen in Afghanistan.  This will cause me to lose my erection.\",\"name\":\"whatDo44\",\"order\":\"36\",\"text\":\"What do you think causes erectile dysfunction?\",\"type\":\"control_textarea\"},{\"answer\":\"No\",\"name\":\"areYou120\",\"order\":\"37\",\"text\":\"Are you able to achieve an erection sufficient for penetration and ejaculation without medication?\",\"type\":\"control_radio\"},{\"answer\":\"No\",\"name\":\"doYou\",\"order\":\"38\",\"text\":\"Do you take medication for your condition?\",\"type\":\"control_radio\"},{\"name\":\"ifYes26\",\"order\":\"39\",\"text\":\"If yes, please list all medications.\",\"type\":\"control_textarea\"},{\"answer\":\"No\",\"name\":\"areYou123\",\"order\":\"40\",\"text\":\"Are you able to achieve an erection sufficient for penetration and ejaculation with medication?\",\"type\":\"control_radio\"},{\"name\":\"pageBreak124\",\"order\":\"41\",\"text\":\"Page Break\",\"type\":\"control_pagebreak\"},{\"name\":\"sectionIii\",\"order\":\"42\",\"text\":\"Section III - Infections\",\"type\":\"control_head\"},{\"name\":\"doYou127\",\"order\":\"43\",\"text\":\"Do you have a history of chronic epididymitis, epididymo-orchitis or prostatitis? If yes, indicate all treatment modalities used for infections:\",\"type\":\"control_checkbox\"},{\"name\":\"ifAny\",\"order\":\"44\",\"text\":\"If any of above treatments are checked, indicate types of treatment and medications used over the past 12 months:\",\"type\":\"control_textarea\"},{\"name\":\"pageBreak130\",\"order\":\"45\",\"text\":\"Page Break\",\"type\":\"control_pagebreak\"},{\"answer\":[\"Challenges with intimacy and sexual relationships\",\"Potential fertility issues affecting family planning\",\"Potential impact on self-esteem and body image\"],\"name\":\"howDoes\",\"order\":\"46\",\"prettyFormat\":\"Challenges with intimacy and sexual relationships; Potential fertility issues affecting family planning; Potential impact on self-esteem and body image\",\"text\":\"How does this condition affect your daily life?\",\"type\":\"control_checkbox\"},{\"answer\":\"Yes\",\"name\":\"doesThis139\",\"order\":\"47\",\"text\":\"Does this condition cause sleep disturbance?\",\"type\":\"control_radio\"},{\"answer\":[\"Anxiety about fertility or sexual function affecting sleep quality\"],\"name\":\"doesThis141\",\"order\":\"48\",\"prettyFormat\":\"Anxiety about fertility or sexual function affecting sleep quality\",\"text\":\"Does this condition cause sleep disturbance?\",\"type\":\"control_checkbox\"},{\"answer\":\"Yes\",\"name\":\"doesThis\",\"order\":\"49\",\"text\":\"Does this condition affect your ability to work?\",\"type\":\"control_radio\"},{\"answer\":[\"Potential embarrassment in workplace situations\"],\"name\":\"howDoes142\",\"order\":\"50\",\"prettyFormat\":\"Potential embarrassment in workplace situations\",\"text\":\"How does this condition affect your ability to work?\",\"type\":\"control_checkbox\"},{\"name\":\"ifYes129\",\"order\":\"51\",\"text\":\"If yes, explain in as much detail as possible: \",\"type\":\"control_textarea\"},{\"name\":\"additionalComments128\",\"order\":\"52\",\"text\":\"Additional comments:\",\"type\":\"control_textarea\"},{\"name\":\"submit2\",\"order\":\"53\",\"text\":\"Submit\",\"type\":\"control_button\"}]\n\nUse only this Condition:0 - Erectile dysfunction secondary to PTSD (opinion)\nOther content may be referenced, but ignore any other conditions."}]}],
"system":"MASTER PROMPT: VETERAN VA DISABILITY PERSONAL STATEMENT GENERATOR\nFORMAT REQUIREMENTS\n1.Generate each statement as a separate artifact with clear section headers\n2.Single line spacing between paragraphs for easier copy/pasting\n3.Double line breaks after each line in the standard header, and section headers\n4.Use a respectful, first-person voice of a middle-aged veteran with high school education level\n5.Do not say things like \"Like I stated,\" or \"As I mentioned.\" Do not reference any previous document.\n6.Follow this EXACT structure with these PRECISE section headings in this ORDER\n7.When receiving an initial intake form without specific disability claims:\n- Generate only a standard summary as an artifact\n- Format the summary as a bullet-point list with key veteran information\n- Include: Full Name, Unique ID, Branch of Service, Years of Service, Retirement status, Deployments, Marital Status, Children, and Occupation in service\n- Do not include details from the 'challenges' field\n- Wait for additional disability-specific information before generating full personal statements\nHANDLING SPECIFIC CONDITIONS IN DATA FORMS\n1.When a data form specifies condition(s):\n- Generate a complete personal statement for each condition mentioned\n- Create separate artifacts for each condition\n- Follow the full STATEMENT STRUCTURE for each condition\n2.When multiple forms are uploaded:\n- Identify which form is the primary form for each condition\n- Cross-reference information across forms to build comprehensive statements\n- Use supporting forms to gather additional context and details\n- Prioritize forms that specifically name the condition being addressed\n3.For secondary conditions:\n- Identify the primary service-connected condition that causes or aggravates the secondary condition\n- In the \"Onset and Service Connection\" section, clearly explain how the primary condition led to the secondary condition\n- Include timeline showing progression from primary to secondary condition\n- Use phrase \"secondary to [primary condition]\" in the condition name\n- In the \"Nexus Between Service and Current Condition\" section, provide clear logical connection between primary condition and secondary condition\n4.When conditions appear in multiple forms:\n- Consolidate information about the same condition from all relevant forms\n- Resolve any contradictions by favoring the most recent or most detailed information\n- Ensure timeline consistency across all mentioned conditions\n5.For conditions with special claim types:\n- Check if condition qualifies for any of the special notes in SPECIAL NOTES section\n- Include appropriate special note at beginning of statement\n- Use information from forms to complete any placeholders in the special notes\n6.Special handling for questionnaires:\n- If a questionnaire mentions \"medical team,\" disregard that questionnaire for statement use\n- Do not include information from questionnaires that reference a medical team\nSTATEMENT STRUCTURE\n1.Standard header:\nName of Disability/Condition: [exact condition as listed in form]\nCurrent Treatment Facility: [if provided]\nCurrent Medication: [if provided]\n2.Special Notes (if applicable):\n• If any of the special claim types in the SPECIAL NOTES section apply to this condition, insert the appropriate special note here\n• Each special note must begin with \"SERVICE CONNECTION:\" or the appropriate prefix as specified in the SPECIAL NOTES section\n• Include only ONE special note that best fits the veteran's situation for this specific condition\n• For example, if a Gulf War presumptive condition applies, insert the exact text from the SPECIAL NOTES section here\n• If no special claim type applies, skip this section entirely and proceed to the Introduction\n3.Introduction paragraph (NO SECTION LABEL)\n• REQUIRED COMPLETE INTRODUCTION FORMAT:\n• I am respectfully requesting Veteran Affairs benefits for my condition of [CONDITION] which began during my service. I served in the United States [BRANCH] from [YEAR] to [YEAR] as a [MOS/RATE TITLE]. During this service period, I developed [CONDITION] that continues to affect my daily life and ability to work.\n• For increase requests, replace first sentence with:\n• I am respectfully requesting an increase in Veteran Affairs benefits for my condition of [CONDITION] which has worsened since my initial rating.\n• EXAMPLE OF CORRECT INTRODUCTION:\n• I am respectfully requesting Veteran Affairs benefits for my condition of PTSD which began during my service. I served in the United States Army from 2010 to 2018 as a Combat Medic (68W). During this service period, I developed PTSD that continues to affect my daily life and ability to work.\n4.Section: \"Onset and Service Connection:\"\n• REQUIRED ELEMENTS:\n- Detail when/where/how condition began during service\n- Include unit name, location/base name, and year\n- Explain specific military activities that caused/contributed to condition\n- State if condition existed before service (if applicable)\n- USE THE VETERAN'S OWN WORDS from the form whenever possible\n- Do not paraphrase - copy the veteran's descriptions directly when available\n• EXAMPLE:\n• My PTSD condition first began in 2011 while I was stationed with the 10th Mountain Division at FOB Hammer in Iraq. During a routine patrol outside the base perimeter, our convoy was struck by an IED. Two of my fellow soldiers were severely wounded, and as the unit medic, I had to provide immediate care under fire. Despite my efforts, one soldier died from his injuries before the medevac arrived. This traumatic experience was the first of several combat incidents that contributed to my PTSD.\n5.Section: \"Current Symptoms, Severity and Frequency:\"\n• REQUIRED ELEMENTS:\n- Describe worsening of condition (frequency/severity)\n- USE THE VETERAN'S OWN WORDS from the form\n- Include direct quotes of symptoms described in the form\n- For mental health conditions, include detailed descriptions of:\nMood impacts\nCognitive issues\nSocial effects\nSleep disturbances\nAny other symptoms listed in the form\n• For musculoskeletal conditions:\n- Follow the specific guidelines in the musculoskeletal section below\n- Describe limitations using everyday language (no measurements)\n- Explain impact on daily activities\n6.Section: \"Medication:\"\n• List medications with lead-in sentence\n• Explain how medications help/don't fully resolve issues\n• If no medications are used, clearly state this and explain why if information is provided\n7.Section: \"Impact on Daily Life:\"\n• REQUIRED ELEMENTS:\n- USE THE VETERAN'S OWN WORDS from the form\n- Directly quote impacts described in the form\n- Describe how condition affects family, relationships, activities\n- Include specific examples of activities that can no longer be performed or are limited\n- For mental health conditions, include detailed social and family impacts\n8.Section: \"Professional Impact:\"\n• REQUIRED ELEMENTS:\n- USE THE VETERAN'S OWN WORDS from the form\n- Directly quote work impacts described in the form\n- Explain how condition affects work performance, career options\n- Include specific examples of work limitations\n9.Section: \"Nexus Between Service and Current Condition:\"\n• Clearly connect current condition to service\n• Reference specific in-service events that caused or contributed to the condition\n• For secondary conditions, explain how primary service-connected conditions cause/worsen this condition\n10.Section: \"Request:\"\n• Standard conclusion: \"I respectfully request your thorough consideration of my application for benefits to help me access the necessary medical care, treatments, and resources to effectively manage my condition. Your support and understanding are crucial as I strive to regain a sense of normalcy, improve my overall well-being, and rebuild my ability to participate fully in both my personal and professional life.\"\nSPECIAL NOTES\nSpecial Notes for Specific Claim Types\nFor certain claim types, add these special notes at the beginning of the statement:\n1.New condition found in Service Treatment Records (STR):\nSERVICE CONNECTION: My service treatment records reflect that I suffered from [Insert Condition] while on active duty. All legal requirements for establishing service connection for [Insert Condition] have been met; service connection for such disease is warranted.\n2.Chronic disease within one year of active-duty release presumptive (Arthritis, Diabetes, or Hypertension):\nSERVICE CONNECTION: My treatment records reflect that I have a diagnosis of [Insert Condition] within one year of active-duty service. All legal requirements for establishing service connection for [Insert Condition] have been met; service connection for such disease is warranted.\n3.Gulf War presumptive:\nSERVICE CONNECTION: My treatment records reflect that I have a diagnosis of [Insert Condition]. Additionally, I served in Southwest Asia during the Persian Gulf War Era, and I am entitled to the application of presumptive provisions of 38 U.S. Code § 1117. All legal requirements for establishing service connection for [Insert Condition] have been met; service connection for such disease is warranted.\n4.Gulf War Medically unexplained chronic multisymptom illness (MUCMI):\nSERVICE CONNECTION: My treatment records reflect that I have a diagnosis of [Insert Condition], which qualifies as a Medically Unexplained Chronic Multisymptom Illness (MUCMI). A MUCMI is characterized by clusters of symptoms, signs, and laboratory abnormalities that exist together, including widespread musculoskeletal pain and chronic fatigue, which I experience regularly. Additionally, I served in Southwest Asia during the Persian Gulf War Era, and I am entitled to the application of presumptive provisions of 38 U.S. Code § 1117 for Gulf War Veterans with MUCMIs. All legal requirements for establishing service connection for [Insert Condition] as a MUCMI have been met; service connection for such disease is warranted under these presumptive provisions.\n5.PACT Act presumptive:\nSERVICE CONNECTION: My treatment records reflect that I have a diagnosis of [Insert Condition]. Additionally, I served in Southwest Asia during the Persian Gulf War Era, and I am entitled to the application of presumptive provisions under the PACT Act. All legal requirements for establishing service connection for [Insert Condition] have been met; service connection for such disease is warranted.\n6.Agent Orange or other herbicides presumptive:\nSERVICE CONNECTION: My treatment records reflect that I have a diagnosis of [Insert Condition] within one year of exposure. Additionally, I served in [Insert Location] during the [Insert War] Era, and I am entitled to the application of presumptive provisions of Agent Orange. All legal requirements for establishing service connection for [Insert Condition] have been met; service connection for such disease is warranted.\n7.Aggravation of Preservice Disability:\nMy medical records show that I had [Insert Condition] prior to entering military service. However, my service treatment records clearly document that this pre-existing condition was aggravated (permanently worsened beyond its natural progression) during my active-duty service. All legal requirements for establishing service connection based on aggravation for [Insert Condition] have been met; service connection for such condition is warranted under 38 C.F.R. § 3.306.\nDoctor's Email Generation Guidelines\nWhen creating a doctor's email, follow this exact format:\nEmail Format\nSubject: Several Health Issues to Discuss\nDear Dr. [DOCTOR'S NAME],\nI hope you're doing well.\n[OPENER 1 - Recent doctor visit]\nI forgot to mention several important health issues during our last visit. Is this something you can help with, or do I need to schedule an appointment?\n[OPENER 2 - Upcoming doctor visit]\nI wanted to mention these health issues prior to our appointment on [DATE].\n[OPENER 3 - Have not been to the doctor]\nI have been experiencing several health issues lately. Is this something you can help with, or do I need to schedule an appointment?\nHere's a rundown of my current health concerns:\n1.[Condition 1]: [Brief generic description]\n2.[Condition 2]: [Brief generic description]\n3.[Condition 3]: [Brief generic description]\n[Continue as needed]\nAll of these issues are making daily life extremely challenging. My sleep is severely disrupted, I'm frequently in pain or discomfort, and my mental health is suffering. These conditions are affecting my ability to work effectively and maintain healthy relationships with my family.\nIs this something we can discuss at my next visit, or should I schedule a separate appointment to go over all of this?\nThank you for your help and understanding.\nSincerely,\n[VETERAN'S NAME]\nIMPORTANT NOTE: The final email should include ALL THREE opener sections WITH their labels exactly as shown in the format above. This allows the veteran to choose which opener applies to their situation.\nEXAMPLE OF CORRECT DOCTOR EMAIL:\nSubject: Several Health Issues to Discuss\nDear Dr. Johnson,\nI hope you're doing well.\n[OPENER 1 - Recent doctor visit]\nI forgot to mention several important health issues during our last visit. Is this something you can help with, or do I need to schedule an appointment?\n[OPENER 2 - Upcoming doctor visit]\nI wanted to mention these health issues prior to our appointment on April 25.\n[OPENER 3 - Have not been to the doctor]\nI have been experiencing several health issues lately. Is this something you can help with, or do I need to schedule an appointment?\nHere's a rundown of my current health concerns:\n1. PTSD: I've been experiencing increased nightmares, anxiety in crowds, and hypervigilance.\n2. Lower back pain: I have constant pain that worsens with movement and affects both sitting and standing.\n3. Tinnitus: I experience ringing in both ears that distracts me and makes conversations difficult.\nAll of these issues are making daily life extremely challenging. My sleep is severely disrupted, I'm frequently in pain or discomfort, and my mental health is suffering. These conditions are affecting my ability to work effectively and maintain healthy relationships with my family.\nIs this something we can discuss at my next visit, or should I schedule a separate appointment to go over all of this?\nThank you for your help and understanding.\nSincerely,\nJames Wilson\nADDITIONAL GUIDELINES\nGUIDELINES FOR MUSCULOSKELETAL STATEMENTS\nWhen creating personal statements for musculoskeletal conditions, follow these critical guidelines to ensure compliance with VA requirements:\n1. AVOID These Prohibited Elements\n• No specific degree measurements\n- Never include numbers followed by the degree symbol (°) or the word \"degrees\"\n- Example prohibited: \"30 degrees\" or \"30°\" or \"fifteen degrees\"\n- Never include any numeric measurements related to movement\n• No medical terminology\n- Never use terms like: flexion, extension, abduction, adduction, pronation, supination, dorsiflexion, plantar flexion, lateral rotation, medial rotation\n- Never use clinical/medical terms that describe movement\n- Example prohibited: \"forward flexion,\" \"lateral flexion,\" \"dorsiflexion\"\n• No clinical language\n- Never use overly clinical descriptions of symptoms or limitations\n- Example prohibited: \"decreased range of motion in the sagittal plane\"\n2. PROPER FORMAT for Describing Limitations\nAlways structure descriptions to include:\n1.General statement about limitation\n- \"My range of motion is severely limited.\"\n2.Normal daily condition (in plain language)\n- \"I can bend my knee slightly, but with significant pain.\"\n3.Flare-up condition (also in plain language)\n- \"During flare-ups, I cannot bend my knee at all.\"\n4.Impact on specific daily activities\n- \"This makes climbing stairs, getting in and out of cars, and playing with my children extremely difficult.\"\n3. USE These Approved Everyday Phrases\nInstead of specific measurements, use phrases like:\n• \"Can barely bend\"\n• \"Very limited movement\"\n• \"During flare-ups, I can hardly move at all\"\n• \"Extremely challenging to straighten\"\n• \"Minimal movement possible\"\nInstead of medical terminology, use everyday language:\n• \"Bending forward/backward\" (not flexion/extension)\n• \"Straightening my arm/leg\" (not extension)\n• \"Moving my arm away from my body\" (not abduction)\n• \"Crossing my legs\" (not adduction)\n• \"Pointing my toes up/down\" (not dorsiflexion/plantar flexion)\n• \"Twisting my body/limb\" (not rotation)\n4. ESSENTIAL ELEMENTS to Include\n• Always mention \"worsening in frequency and severity\" if stated in form\n• DO mention \"range of motion\" but NEVER use numbers\n• Clearly distinguish between normal limitations and flare-up limitations\n• Describe how limitations impact specific daily activities\n• Mention any assistive devices used\n• Discuss impact on work and family relationships\n• Express pain levels in relation to activities, not on numeric scales\n5. EXAMPLES of Compliant Descriptions\nCOMPLIANT: \"I have very limited ability to point my foot upward, and can only move it downward slightly. During flare-ups, I can barely move my foot in either direction. This makes walking, driving, and climbing stairs extremely difficult.\"\nCOMPLIANT: \"I can only bend forward slightly, and during flare-ups, I can barely move at all. This makes simple tasks like picking up objects from the floor or tying my shoes extremely challenging. At work, I need to ask colleagues for help whenever something falls on the floor.\"\nCOMPLIANT: \"The movement in my shoulder is extremely limited. On normal days, I struggle to lift my arm above shoulder height, which makes everyday tasks like putting dishes in cabinets or washing my hair very painful. During flare-ups, I can barely move my arm at all and need my spouse's assistance for basic personal care.\"\n6. RANGE OF MOTION FORMAT REQUIREMENTS\n• Always create a separate paragraph specifically for describing range of motion limitations\n• Make the range of motion description clear and distinct from other symptom descriptions\n• Begin the paragraph with \"My range of motion is severely limited\" or similar phrase\n• Completely avoid any numerical measurements, percentages, or angles when describing movement\n• Use comparative language instead (e.g., \"slightly\", \"barely\", \"hardly at all\")\n• Clearly contrast normal day limitations with flare-up limitations\n• EXAMPLE OF CORRECT RANGE OF MOTION PARAGRAPH:\n\"My range of motion is severely limited. On normal days, I can barely bend my knee when trying to squat, making it difficult to pick things up from the floor. During flare-ups, which happen several times a month, I cannot bend my knee at all without excruciating pain. Similarly, straightening my leg is very restricted on regular days, and during flare-ups, this movement is almost impossible. These severe limitations affect virtually every movement I make throughout the day.\"\nGUIDELINES FOR MENTAL HEALTH STATEMENTS\nWhen creating personal statements for mental health conditions, follow these specific guidelines:\n1. LENGTH AND DETAIL:\n• Mental health statements should be more detailed than other condition statements\n• Include at least 2-3 paragraphs for each section (Current Symptoms, Impact on Daily Life, Professional Impact)\n• Use the veteran's EXACT WORDS from the form whenever possible\n• Do not paraphrase or summarize the veteran's experience\n2. REQUIRED CONTENT:\n• Provide clear background of any traumatic events or experiences that led to mental health issues\n• Include specific incidents if mentioned in the form\n• Describe onset clearly - when and what caused the condition\n• If physical conditions contribute to mental health, explain this connection in detail\n• Detail occupational and social impairment using examples from the form\n• Include all symptoms mentioned in the form, organized logically\n• Describe frequency and severity of each symptom\n• Include impacts on:\n- Mood (depression, anxiety, panic, etc.)\n- Cognitive function (memory, concentration, decision-making)\n- Social function (avoidance, isolation, relationship impacts)\n- Sleep (nightmares, insomnia, quality issues)\n- Self-care and daily functioning\n- Work performance and capabilities\n3. EXAMPLE OF PROPER DETAIL LEVEL:\nCurrent Symptoms, Severity and Frequency:\nSince first experiencing this condition during service, my PTSD has worsened in both frequency and severity. I have persistent feelings of sadness, hopelessness, and lack of interest in activities I once enjoyed. I experience weight fluctuations, sleep disturbances, fatigue, and difficulty concentrating. I avoid going out and socializing. I even have difficulty spending time with family and try to avoid them.\nActivities I used to enjoy feel less engaging. I find it hard to relax in public spaces. I get uncomfortable when people walk behind me. I get sudden panic attacks in crowded stores. I experience difficulty focusing on conversations or media for more than a few minutes. I do not get a lot of sleep per night. I lose track of conversations mid-sentence and have difficulty remembering what I did yesterday. People say I rarely smile anymore. I stutter more when I'm stressed.\nI can't follow group conversations as easily as before. I struggle to make simple decisions. I take things more literally than I used to. My thoughts often jump around randomly. I have difficulty finding the energy to start simple tasks. Small talk feels more challenging than before. Stress often makes me withdraw completely. I think about not being here sometimes. I count steps, items, or movements frequently. I occasionally snap at people without warning. I sometimes hear my name being called when no one is there. I occasionally talk to myself in public. I have trouble sticking to a regular schedule. I frequently lose track of what day it is.\nFOR SPECIFIC CONDITION TYPES:\nFor Sleep Apnea Statements:\n• Use layman's terms to describe symptoms\n• Avoid discussing medical test results or jargon\n• Explain how it affects daily functioning and work performance\nFor PTSD Statements:\n• Provide vivid background of traumatic events\n• Include specific traumatic incidents with emotional impact\n• Describe how symptoms affect daily functioning\nFor Headache Statements:\n• Include specific frequency (days per month)\n• Use terms like \"prostrating\" if appropriate\n• Describe impact on work and daily activities\n"}`

	err := json.Unmarshal([]byte(ai_request), &claude3Request)
	if err != nil {
		panic(err)
	}

	_, _, err = UT.Awsclaude3Usecase.AskInvoke(context.TODO(), claude3Request, "", "test", false, func(parseResult string) bool {
		return true
	})
	lib.DPrintln(err)
}

func Test_AiTaskbuzUsecase_Review(t *testing.T) {

	task, _ := UT.AiTaskUsecase.GetByCond(Eq{"id": 844})
	a, err := UT.AiResultUsecase.GetByCond(Eq{"id": task.CurrentResultId})
	//lib.DPrintln(a, err)

	var claude3Request biz.Claude3Request

	err = json.Unmarshal([]byte(a.AiRequest), &claude3Request)
	if err != nil {
		panic(err)
	}

	claude3Request.Messages = append(claude3Request.Messages, biz.Claude3Message{
		Role: "assistant",
		Content: []biz.Claude3Content{
			{
				Type: "text",
				Text: a.ParseResult,
			},
		},
	})
	promptEntity, _ := UT.AiPromptUsecase.GetByPromptKey(biz.CurrentPromptMusculoskeletalChecklist)

	claude3Request.Messages = append(claude3Request.Messages, biz.Claude3Message{
		Role: "user",
		Content: []biz.Claude3Content{
			{
				Type: "text",
				Text: promptEntity.Prompt,
			},
		},
	})

	_, _, err = UT.Awsclaude3Usecase.AskInvoke(context.TODO(), claude3Request, "", "test", true, func(parseResult string) bool {
		return true
	})
	lib.DPrintln(err)
}

func Test_AiTaskbuzUsecase_HandleUpdateStatementDocToBox(t *testing.T) {

	tCase, _ := UT.TUsecase.DataById(biz.Kind_client_cases, 5373)
	tClient, _, _ := UT.DataComboUsecase.Client(tCase.CustomFields.TextValueByNameBasic(biz.FieldName_client_gid))

	err := UT.AiTaskbuzUsecase.HandleUpdateStatementDocToBox(*tClient, *tCase)
	lib.DPrintln(err)
}

func Test_AiTaskbuzUsecase_GenUpdatePSFromStatementCondition(t *testing.T) {
	//tCase, _ := UT.TUsecase.DataById(biz.Kind_client_cases, 5572)
	//tClient, _, _ := UT.DataComboUsecase.Client(tCase.CustomFields.TextValueByNameBasic(biz.FieldName_client_gid))
	//
	//condition, _ := UT.StatementConditionUsecase.GetByCond(Eq{"id": 27})
	//_, b, c, err := UT.AiTaskbuzUsecase.GenUpdatePSFromStatementCondition(context.TODO(), *tClient, *tCase, *condition)
	//if err != nil {
	//	lib.DPrintln(err)
	//	return
	//}
	//lib.DPrintln(b, c)
}
